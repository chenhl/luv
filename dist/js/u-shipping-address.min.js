function collectAddressData(){var result={success:true,data:{},error:{}};$("#address-form input, #address-form select").each(function(){var $this=$(this);if(!checkAddressInput($this)){result.success=false;result.error=$this;return false}else{if(typeof $this.attr("name")!="undefined"){result.data[$this.attr("name")]=$this.val()}}});return result}function checkAddressInput($input){const value=$input.val();const required=$input.prop("required");if(required&&value===""){return false}if($input.attr("name")=="editForm[email]"){if(!check_email(value)){return false}}return true}function loadStatesByCountry(country){$.get(changeCountryUrl,{country:country}).done(function(data){$("#address-state-js").html(data.stateHtml)}).fail(function(){alert("Failed to load states")})}$(document).ready(function(){$(document).on("change","#is-default-input-js",function(){$(this).val(this.checked?1:2)});$(document).on("focus","#address-form input:not([readonly])",function(){$(this).removeClass("is-invalid");$(this).next().removeClass("d-block")}).on("blur","#address-form input:not([readonly])",function(){if(!checkAddressInput($(this))){$(this).addClass("is-invalid");$(this).next().addClass("d-block")}});var pendingDeleteAddressId=null;$("#removeDialog").on("show.bs.modal",function(event){var button=$(event.relatedTarget);pendingDeleteAddressId=button.data("address-id")});$("#removeDialog .btn-danger").on("click",function(){if(pendingDeleteAddressId){$("#removeDialog").modal("hide");$.post(addressRemoveUrl,{address_id:pendingDeleteAddressId,[csrfName]:csrfVal}).done(function(data){if(data.status==="success"){window.location.href=addressListUrl}else{alert(data.message||"Error")}}).fail(function(){alert("Failed to delete address")});pendingDeleteAddressId=null}});$(document).on("click","#btn-save-address-js",function(){var $btn=$(this);if($btn.prop("disabled")){return false}$btn.prop("disabled",true).text(translations.savIng);var addressData=collectAddressData();if(!addressData.success){$(this).prop("disabled",false).text(translations.save);addressData.error.addClass("is-invalid");addressData.error.next().addClass("d-block");return false}$.ajax({url:addressSaveUrl,timeout:6e3,dataType:"json",type:"post",data:addressData.data,success:function(data){$btn.prop("disabled",false).text(translations.save);if(data.status=="success"){window.location.href=addressListUrl}else{alert(data.message)}},error:function(XMLHttpRequest,textStatus,errorThrown){alert("Oops! Something went wrong. Please try again in a few minutes.");$btn.prop("disabled",false).text(translations.save)}})});$("#countryModal").on("show.bs.modal",function(e){const currentCode=$("#country-code-input-js").val();$(".country-item-js .country-checked-js").remove();if(currentCode){const $item=$('.country-item-js[data-code="'+currentCode+'"]');if($item.length){$item.find("span").after('<span class="country-checked-js"><i class="fa-solid fa-check text-danger"></i></span>');const $group=$item.closest(".alphabet-group-js");if($group.length){$group.removeClass("d-none")}setTimeout(()=>{$item[0].scrollIntoView({behavior:"smooth",block:"center"})},100);return}}setTimeout(()=>{document.getElementById("common-group-js")?.scrollIntoView({behavior:"smooth",block:"start"})},100)});$(document).on("click",".alphabet-js",function(){const letter=$(this).attr("rel");const $group=$("#alphabet-"+letter);if($group.hasClass("d-none")){$group.removeClass("d-none")}$group[0].scrollIntoView({behavior:"smooth",block:"start"})});$(document).on("click",".country-item-js",function(){const code=$(this).data("code");const name=$(this).data("name");$("#country-code-input-js").val(code);$("#country-name-input-js").val(name);$("#countryModal").modal("hide");loadStatesByCountry(code)})});