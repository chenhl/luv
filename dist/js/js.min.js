function isStrictMode(){return function(){return!this}()}function isSurportedLoading(){return"loading"in HTMLImageElement.prototype}function isLikelyMobile(){const ua=navigator.userAgent;if(/Android|iPhone|BlackBerry|Opera Mini|IEMobile|Mobile|Tablet/i.test(ua)){return true}if(navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1){return true}if(screen.width<=768&&"ontouchstart"in window){return true}return false}function isLikelyAutomated(){const ua=navigator.userAgent;if(typeof isbot==="function"&&isbot(ua)){return true}else{if(/Googlebot|Bingbot|YandexBot|Baiduspider|DuckDuckBot|Slurp|Sogou|Applebot/i.test(ua)){return true}}if(navigator.webdriver===true||/HeadlessChrome|PhantomJS|Selenium|Puppeteer|Cypress|Playwright/i.test(ua)){return true}if(screen.width===0||screen.height===0){return true}let domContentLoadedTime=null;if(performance.getEntriesByType){const entries=performance.getEntriesByType("navigation");if(entries.length>0){domContentLoadedTime=entries[0].domContentLoadedEventEnd}}if(domContentLoadedTime===null&&performance.timing){domContentLoadedTime=performance.timing.domContentLoadedEventEnd-performance.timing.navigationStart}if(domContentLoadedTime!==null&&domContentLoadedTime>0&&domContentLoadedTime<10){return true}return false}window.TrackingPolicy={isDebug:function(){return window.location.search.indexOf("debug=1")>-1||typeof window.DEBUG_TRACKING!=="undefined"&&window.DEBUG_TRACKING}(),isAllowed:function(){if(getCookie("tracking_consent")==="0")return false;if(getCookie("tracking_consent")==="1")return true;return true}(),log:function(...args){if(this.isDebug){console.log("[Tracking]",...args)}},error:function(...args){console.error("[Tracking Error]",...args)}};function setCookie(name,value,days){days=days||30;var expires="";var date=new Date;date.setTime(date.getTime()+days*24*60*60*1e3);expires="; expires="+date.toUTCString();document.cookie=name+"="+encodeURIComponent(value)+expires+"; path=/"}function getCookie(name){var v=document.cookie.match("(^|;) ?"+name+"=([^;]*)(;|$)");return v?decodeURIComponent(v[2]):null}const UrlUtils={create:(url,origin=window.location.origin)=>new URL(url,origin),getCurrentParams:()=>new URLSearchParams(window.location.search),mergeParams:(url,paramsObj)=>{const newUrl=typeof url==="string"?new URL(url,window.location.origin):url;Object.keys(paramsObj).forEach(key=>{if(paramsObj[key]!==undefined&&paramsObj[key]!==null){newUrl.searchParams.set(key,paramsObj[key])}});return newUrl.toString()},buildQuery:paramsObj=>{const params=new URLSearchParams;Object.keys(paramsObj).forEach(key=>{if(paramsObj[key]!==undefined&&paramsObj[key]!==null){params.set(key,paramsObj[key])}});return params.toString()},getEffectiveRootDomain:host=>{if(typeof host!=="string")return null;const parts=host.toLowerCase().split(".").filter(p=>p.length>0);if(parts.length<2)return host;const TWO_PART_SUFFIXES=new Set(["co.uk"]);if(parts.length>=3){const lastTwo=parts.slice(-2).join(".");if(TWO_PART_SUFFIXES.has(lastTwo)){return parts.slice(-3).join(".")}}return parts.slice(-2).join(".")},isValidUrl:url=>{if(typeof url!=="string"||!url.startsWith("https://")){return false}try{new URL(url);return true}catch{return false}},isSameDomain:(mainUrl,candidateUrl)=>{if(!UrlUtils.isValidUrl(mainUrl)||!UrlUtils.isValidUrl(candidateUrl)){return false}try{const mainHost=new URL(mainUrl).host;const candidateHost=new URL(candidateUrl).host;const mainRoot=UrlUtils.getEffectiveRootDomain(mainHost);const candidateRoot=UrlUtils.getEffectiveRootDomain(candidateHost);return mainRoot===candidateRoot}catch{return false}},getQueryParam:(name,url)=>{url=url||window.location.href;try{var params=new URL(url).searchParams;return params.get(name)||""}catch(e){var regex=new RegExp("[?&]"+escapeRegExp(name)+"=([^&]*)");var match=regex.exec(url);if(match){return decodeURIComponent((match[1]||"").replace(/\+/g," "))}return""}},getPathParam:(key,path=window.location.pathname)=>{const parts=path.split("/").filter(Boolean);for(let i=0;i<parts.length-1;i++){if(parts[i]===key){try{return decodeURIComponent(parts[i+1].replace(/\+/g," "))}catch(e){return parts[i+1]}}}return""},addQueryParam:(param,value,url)=>{try{var urlObj=new URL(url,window.location.origin);urlObj.searchParams.set(param,value);return urlObj.href}catch(e){var hashSplit=url.split("#");var baseUrl=hashSplit[0];var hash=hashSplit[1]||"";var regex=new RegExp("[?&]"+escapeRegExp(param)+"=([^&]*)");var hasParam=regex.test(baseUrl);var encodedValue=encodeURIComponent(value);if(hasParam){baseUrl=baseUrl.replace(regex,function(match,p1,offset,str){return match.charAt(0)+param+"="+encodedValue})}else{var separator=baseUrl.indexOf("?")===-1?"?":"&";baseUrl+=separator+param+"="+encodedValue}return hash?baseUrl+"#"+hash:baseUrl}},buildFriendlyUrl:(param,value,url)=>{try{const urlObj=new URL(url,window.location.origin);let pathname=urlObj.pathname;const safeParam=param.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");const friendlyRegex=new RegExp(`/${safeParam}/[^/?#]+/?`);pathname=pathname.replace(friendlyRegex,"");const trailingRegex=new RegExp(`/${safeParam}$`);pathname=pathname.replace(trailingRegex,"");pathname=pathname.replace(/\/+$/,"");pathname+=`/${param}/${encodeURIComponent(value)}/`;urlObj.pathname=pathname;return urlObj.href}catch(error){console.error("UrlUtils.buildFriendlyUrl failed:",error,{param:param,value:value,url:url});let cleanUrl=url.split("#")[0];const hash=url.includes("#")?url.slice(url.indexOf("#")):"";cleanUrl=cleanUrl.replace(new RegExp(`/${param}/[^/?#]+/?`),"");cleanUrl=cleanUrl.replace(new RegExp(`/${param}$`),"");cleanUrl=cleanUrl.replace(/\/+$/,"");return`${cleanUrl}/${param}/${value}/${hash}`}}};function getBrowserData(){return{deviceChannel:"browser",screenWidth:screen.width||0,screenHeight:screen.height||0,colorDepth:screen.colorDepth||0,language:(navigator.language||"en").split("-")[0],timezoneOffset:(new Date).getTimezoneOffset(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone||"Unknown",javaScriptEnabled:true,userAgent:navigator.userAgent}}function getBrowserDataWithBowser(){var browserData=getBrowserData();if(typeof bowser!=="undefined"&&typeof bowser.getParser==="function"){try{var parser=bowser.getParser(navigator.userAgent);var result=parser.getResult();browserData.browserName=result.browser?.name||"Unknown";browserData.browserVersion=result.browser?.version||"";browserData.osName=result.os?.name||"Unknown";browserData.osVersion=result.os?.version||"";browserData.platform=result.platform?.type||"desktop";browserData.deviceVendor=result.platform?.vendor||"";browserData.engineName=result.engine?.name||"Unknown"}catch(e){TrackingPolicy.error("bowser parse error:",e)}}if(typeof browserData.browserName==="undefined"){var ua=navigator.userAgent;browserData.browserName="Unknown";browserData.browserVersion="";if(/iPad|iPhone|iPod/.test(ua)){browserData.osName="iOS";browserData.osVersion="";browserData.platform="mobile"}else if(/Android/.test(ua)){browserData.osName="Android";browserData.osVersion="";browserData.platform="mobile"}browserData.deviceVendor="";browserData.engineName="Unknown"}return browserData}window.AffiliateTracker={_config:null,_hasRun:false,_getBrowserData:function(){return getBrowserDataWithBowser()},_shouldTrack:function(aff,cookieAff){if(!aff)return false;var rule=this._config.affiliate_credit;if(rule==="first"&&cookieAff)return false;if(rule==="last"&&cookieAff&&cookieAff===aff)return false;return true},_sendToServer:function(aff){var payload={event:"affiliate",browser:this._getBrowserData(),data:{aff:aff,landing_url:document.URL,referrer_url:document.referrer}};TrackingPolicy.log("Sending affiliate click:",aff,payload);fetch(this._config.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload),keepalive:true}).then(function(res){if(!res.ok)throw new Error("HTTP "+res.status);return res.json()}).then(function(data){if(data.visit_id>0){setCookie("luv_aff",data.aff,this._config.cookie_duration);setCookie("luv_visit",data.visit_id,this._config.cookie_duration);TrackingPolicy.log("Affiliate tracked. Visit ID:",data.visit_id)}}.bind(this)).catch(function(err){TrackingPolicy.error("Affiliate tracking failed:",err)})},init:function(){if(this._hasRun)return;this._hasRun=true;if(!TrackingPolicy.isAllowed){TrackingPolicy.log("Affiliate tracking skipped: consent declined.");return}if(typeof window.affiliate_config==="undefined"){return}if(isLikelyAutomated()){TrackingPolicy.log("Automated traffic detected, skipping tracking.");return}this._config=window.affiliate_config;var aff=UrlUtils.getQueryParam(this._config.affiliate_keyword)||UrlUtils.getPathParam(this._config.affiliate_keyword);var cookieAff=getCookie("luv_aff");if(this._shouldTrack(aff,cookieAff)){this._sendToServer(aff)}else{TrackingPolicy.log("Affiliate skipped:",{aff:aff,cookieAff:cookieAff,rule:this._config.affiliate_credit})}}};window.PageTracker={_config:null,_hasRun:false,_getBrowserData:function(){return getBrowserDataWithBowser()},_shouldTrack:function(){if(typeof this._config.payload==="undefined"){return false}if(typeof this._config.payload.data==="undefined"){return false}if(Array.isArray(this._config.payload.data)&&this._config.payload.data.length===0){return false}return true},_sendToServer:function(){var payload=this._config.payload;payload.browser=this._getBrowserData();TrackingPolicy.log("Sending page view:",payload);fetch(this._config.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload),keepalive:true}).then(function(res){if(!res.ok)throw new Error("HTTP "+res.status);return res.json()}).then(function(data){TrackingPolicy.log("Page tracked.")}.bind(this)).catch(function(err){TrackingPolicy.error("Page tracking failed:",err)})},init:function(){if(this._hasRun)return;this._hasRun=true;if(typeof window.trace_config==="undefined"){return}if(isLikelyAutomated()){TrackingPolicy.log("Automated traffic detected, skipping tracking.");return}this._config=window.trace_config;if(this._shouldTrack()){this._sendToServer()}else{TrackingPolicy.log("Page tracking skipped:",{config:this._config})}}};window.UserTimezone={_storageKeyReported:"utz_reported",_storageKeyTimezone:"utz_value",_getStorage:function(key){try{return localStorage.getItem(key)}catch(e){return null}},_setStorage:function(key,value){try{localStorage.setItem(key,value)}catch(e){}},_shouldReport:function(currentTz){if(!currentTz)return false;var lastTz=this._getStorage(this._storageKeyTimezone);var hasReported=this._getStorage(this._storageKeyReported)==="1";return!hasReported||lastTz!==currentTz},_markAsReported:function(timezone){this._setStorage(this._storageKeyReported,"1");if(timezone){this._setStorage(this._storageKeyTimezone,timezone)}},getBrowserTimezone:function(){try{if(window.Intl&&Intl.DateTimeFormat){return Intl.DateTimeFormat().resolvedOptions().timeZone}}catch(e){TrackingPolicy.error("Timezone detection failed:",e)}return null},sendToServer:function(timezone){if(!timezone)return;TrackingPolicy.log("Reporting timezone:",timezone);var data={timezone:timezone};if(typeof csrfName!=="undefined"){data[csrfName]=csrfVal}$.ajax({url:userTimezoneUrl,method:"POST",data:data,timeout:5e3,success:function(res){if(res&&res.success){window.UserTimezone._markAsReported(timezone)}else{window.UserTimezone._markAsReported(timezone)}},error:function(){TrackingPolicy.error("Timezone report failed:",arguments);window.UserTimezone._markAsReported(timezone)}})},init:function(){if(!TrackingPolicy.isAllowed){TrackingPolicy.log("Timezone reporting skipped: consent declined.");return}var tz=this.getBrowserTimezone();if(tz&&this._shouldReport(tz)){this.sendToServer(tz)}else{TrackingPolicy.log("Timezone not reported.",{tz:tz,should:false})}}};function webLoadScript(url,callback){var script=document.createElement("script");script.type="text/javascript";if(typeof callback!="undefined"){if(script.readyState){script.onreadystatechange=function(){if(script.readyState=="loaded"||script.readyState=="complete"){script.onreadystatechange=null;callback()}}}else{script.onload=function(){callback()}}}script.src=url;document.body.appendChild(script)}function isValidEmail(email){const re=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return re.test(email)}function check_email(email){if(!email||email==""){return false}const myreg=/^([a-zA-Z0-9]+[_|\_|\.|-|\-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.|-|\-]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;if(!myreg.test(email)){return false}return true}function check_pass(str){const re=/^\w{6,30}$/;if(re.test(str)){return true}else{return false}}function showToast(msg,element){element=element||"#toast-js";const toastEl=$(element);if(toastEl){$(element).find(".toast-body").text(msg);const toast=bootstrap.Toast.getOrCreateInstance(toastEl[0]);toast.show()}}function showError($el,message,$input){$el.text(message).removeClass("d-none");$input.addClass("is-invalid")}function hideError($el,$input){$el.addClass("d-none");$input.removeClass("is-invalid")}function copyTextToClipboard(text){return new Promise(function(resolve){if(navigator.clipboard&&window.isSecureContext){navigator.clipboard.writeText(text).then(function(){resolve(true)}).catch(function(err){console.warn("Clipboard API failed, falling back to execCommand:",err);resolve(fallbackCopyText(text))})}else{resolve(fallbackCopyText(text))}})}function fallbackCopyText(text){var textarea=document.createElement("textarea");textarea.value=text;textarea.style.position="fixed";textarea.style.opacity="0";document.body.appendChild(textarea);textarea.select();try{var success=document.execCommand("copy");document.body.removeChild(textarea);return success}catch(err){document.body.removeChild(textarea);return false}}$(function(){if(typeof affiliate_config!=="undefined"){try{AffiliateTracker.init()}catch(e){}}if(typeof trace_config!=="undefined"){try{PageTracker.init()}catch(e){}}if(typeof userTimezoneUrl!=="undefined"){try{UserTimezone.init()}catch(e){}}if(typeof memberCheckUrl!=="undefined"){const ajax_params={};if(typeof product_id!=="undefined"){ajax_params["product_id"]=product_id}$.ajax({async:true,timeout:6e3,dataType:"json",type:"get",data:ajax_params,url:memberCheckUrl,success:function(data,textStatus){if(data.loginStatus){$("#header-welcome-js").removeClass("d-none");$("#header-email-js").text(data.customer_email);$("#header-login-js").addClass("d-none")}if(data.favorite){$("#product-favorite-js").addClass("text-danger")}if(data.favorite_product_count){}if(data.affiliate){$("#affiliate-link-js").show()}if(data.cart_qty){$(".cart-item-count-js").text(data.cart_qty)}},error:function(XMLHttpRequest,textStatus,errorThrown){}})}$("#subscribe_btn").click(function(){var $btn=$(this);$btn.prop("disabled",true);email=$("#subscribe_email").val();if(!check_email(email)){alert("Enter your email address");$btn.prop("disabled",false);return false}$.ajax({dataType:"json",type:"post",data:{email:email},url:"/member/account/subscribe",success:function(data,textStatus){$btn.prop("disabled",false);if(data.success){alert(data.message);$("#subscribe_email").val("")}else{alert(data.message)}},error:function(error){alert("Oops! Something went wrong. Please try again in a few minutes.");$btn.prop("disabled",false)}})})});window.SearchHistory={config:{HISTORY_KEY:"search_history",MAX_LENGTH:20,SYNC_INTERVAL_MINUTES:15,KEYWORD_MAX_LENGTH:100,SAFE_KEYWORD_PATTERN:/^[\p{L}\p{N}\s.;:'"!?-]+$/u},isValidKeyword:function(keyword){if(typeof keyword!==" string")return false;const t=keyword.trim();return t.length>0&&t.length<=this.config.MAX_KEYWORD_LENGTH},isValidKeywordWithRegex:function(keyword,maxLength){if(typeof keyword!=="string")return false;maxLength=maxLength||this.config.KEYWORD_MAX_LENGTH;var trimmed=keyword.trim();if(!trimmed||trimmed.length>maxLength)return false;return this.config.SAFE_KEYWORD_PATTERN.test(trimmed)},getLocalHistory:function(){var raw=localStorage.getItem(this.config.HISTORY_KEY);if(!raw){return{update_time:null,last_sync_time:null,data:[]}}try{var history=JSON.parse(raw);if(Array.isArray(history)){history={update_time:null,last_sync_time:null,data:history};localStorage.setItem(this.config.HISTORY_KEY,JSON.stringify(history))}if(!history.data||!Array.isArray(history.data))history.data=[];return history}catch(e){console.warn("Search history parse error, resetting.",e);return{update_time:null,last_sync_time:null,data:[]}}},saveToLocal:function(keyword){if(!this.isValidKeyword(keyword))return false;var h=this.getLocalHistory();var k=keyword.trim();h.data=h.data.filter(x=>x!==k);h.data.unshift(k);if(h.data.length>this.config.MAX_LENGTH){h.data=h.data.slice(0,this.config.MAX_LENGTH)}h.update_time=(new Date).toISOString();localStorage.setItem(this.config.HISTORY_KEY,JSON.stringify(h));return true},removeFromLocal:function(keyword){if(keyword==null){localStorage.removeItem(this.config.HISTORY_KEY);return}var h=this.getLocalHistory();var k=String(keyword).trim();h.data=h.data.filter(x=>x!==k);h.update_time=(new Date).toISOString();localStorage.setItem(this.config.HISTORY_KEY,JSON.stringify(h))},isSyncNeeded:function(localHistory){if(!localHistory||!localHistory.last_sync_time)return true;var diff=(new Date-new Date(localHistory.last_sync_time))/(1e3*60);return diff>this.config.SYNC_INTERVAL_MINUTES},mergeWithServer:function(serverKeywords){if(!Array.isArray(serverKeywords))return;var local=this.getLocalHistory();local.last_sync_time=(new Date).toISOString();var seen={};var merged=[];local.data.forEach(k=>{if(this.isValidKeyword(k)&&!seen[k]){seen[k]=true;merged.push(k)}});serverKeywords.forEach(k=>{if(this.isValidKeyword(k)&&!seen[k]){seen[k]=true;merged.push(k)}});local.data=merged.slice(0,this.config.MAX_LENGTH);local.update_time=(new Date).toISOString();localStorage.setItem(this.config.HISTORY_KEY,JSON.stringify(local))},pullFromServer:function(url){var local=this.getLocalHistory();if(!this.isSyncNeeded(local))return;$.ajax({url:url,type:"GET",dataType:"json",timeout:6e3,success:data=>{if(data&&Array.isArray(data.data)){this.mergeWithServer(data.data)}},error:()=>{}})},pushToServer:function(url,keyword){if(!this.isValidKeyword(keyword))return;$.ajax({url:url,type:"POST",data:{keyword:keyword.trim()},dataType:"json",timeout:6e3,error:()=>{}})},removeFromServer:function(url,keyword){var data=keyword!=null?{keyword:keyword}:{};$.ajax({url:url,type:"POST",data:data,dataType:"json",timeout:6e3,error:()=>{}})},save:function(keyword,serverUrl){if(this.saveToLocal(keyword)&&serverUrl){this.pushToServer(serverUrl,keyword)}},getKeywords:function(){return this.getLocalHistory().data},clear:function(serverUrl){this.removeFromLocal();if(serverUrl)this.removeFromServer(serverUrl)}};function isValidSearchKeyword(keyword,maxLength=100){keyword=keyword.trim();if(keyword===""){return false}if(keyword.length>maxLength){return false}const safePattern=/^[\p{L}\p{N}\s.;:'"!?-]+$/u;if(!safePattern.test(keyword)){return false}const escapedKeyword=keyword.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return true}const historyKey="search_history";function pullSearchHistory(Url){let localHistory=getCompatibleSearchHistoryFromLocalStorage();if(!isSyncNeeded(localHistory)){return}$.ajax({async:true,timeout:6e3,dataType:"json",type:"get",url:Url,success:function(data,textStatus){if(data.data.length>0){mergeLocalSearchHistory(data.data)}},error:function(XMLHttpRequest,textStatus,errorThrown){}})}function removeHistory(url,keyword){data={};if(keyword){data["keyword"]=keyword}$.ajax({async:true,timeout:6e3,dataType:"json",data:data,type:"post",url:url,success:function(data,textStatus){},error:function(XMLHttpRequest,textStatus,errorThrown){}})}function saveOneSearchHistory(keyword,Url){$.ajax({async:true,timeout:6e3,dataType:"json",type:"post",url:Url,data:{keyword:keyword},success:function(data,textStatus){},error:function(XMLHttpRequest,textStatus,errorThrown){}})}function saveSearchToLocalStorage(keyword){let searchHistory=getCompatibleSearchHistoryFromLocalStorage();const index=searchHistory.data.indexOf(keyword);if(index>-1){searchHistory.data.splice(index,1)}searchHistory.data.unshift(keyword);if(searchHistory.data.length>maxSearchHistoryLength){searchHistory.data=searchHistory.data.slice(0,maxSearchHistoryLength)}searchHistory.update_time=(new Date).toISOString();localStorage.setItem(historyKey,JSON.stringify(searchHistory))}function removeSearchFromLocalStorage(keyword){let searchHistory=JSON.parse(localStorage.getItem(historyKey));if(searchHistory&&Array.isArray(searchHistory.data)){if(keyword){searchHistory.data=searchHistory.data.filter(item=>item!==keyword)}else{localStorage.removeItem(historyKey);return}searchHistory.update_time=(new Date).toISOString();localStorage.setItem(historyKey,JSON.stringify(searchHistory));return}else{localStorage.removeItem(historyKey);return}}function getSearchHistoryFromLocalStorage(){let searchHistory=JSON.parse(localStorage.getItem(historyKey))||{update_time:null,last_sync_time:null,data:[]};return searchHistory}function getCompatibleSearchHistoryFromLocalStorage(){const rawHistory=localStorage.getItem(historyKey);if(!rawHistory){return{update_time:null,last_sync_time:null,data:[]}}let history;try{history=JSON.parse(rawHistory)}catch(e){console.error("Failed to parse history:",e);return{update_time:null,last_sync_time:null,data:[]}}if(Array.isArray(history)){history={update_time:null,last_sync_time:null,data:history};localStorage.setItem(historyKey,JSON.stringify(history))}return history}function isSyncNeeded(history){if(!history||!history.last_sync_time)return true;const lastSyncTime=new Date(history.last_sync_time);const currentTime=new Date;const diffInMinutes=(currentTime-lastSyncTime)/(1e3*60);return diffInMinutes>15}function mergeLocalSearchHistory(serverHistory){let localHistory=getCompatibleSearchHistoryFromLocalStorage();localHistory.last_sync_time=(new Date).toISOString();let mergedData=Array.from(new Set([...localHistory.data,...serverHistory]));localHistory.data=mergedData;localStorage.setItem(historyKey,JSON.stringify(localHistory))}function is_valid_url(url){var regex=new RegExp(/^(https?|s):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i);return regex.test(url)}function is_same_domain(base_url,custom_url){base_url=base_url.replace("http://","").replace("https://","").replace("www.","").replace("m.","").split(/[/?#]/)[0];custom_url=custom_url.replace("http://","").replace("https://","").replace("www.","").replace("m.","").split(/[/?#]/)[0];return base_url==custom_url||base_url.indexOf(custom_url)!=-1||custom_url.indexOf(base_url)!=-1}function process_friendly_url(param,value,url){var hash=url.split("#")[1];url=url.split("#")[0];var re=new RegExp("([/]"+param+"[/][^?]*)"),match=re.exec(url);var re2=new RegExp("([?].*)"),match2=re2.exec(url);if(match&&match[0])url=url.replace(match[0],"");if(match2&&match2[0])url=url.replace(match2[0],"");var re3=new RegExp("([/]"+param+"$)"),match3=re3.exec(url);if(match3&&match3[0])url=url.replace(match3[0],"");url=url.replace(/\/+$/,"");url=url+"/"+param+"/"+value+"/";if(match2&&match2[0])url=url+match2[0];if(hash)url+="#"+hash;return url}function add_query_arg(param,value,url){var re=new RegExp("[\\?&]"+param+"=([^&#]*)"),match=re.exec(url),delimiter,newString;var hash=url.split("#")[1];url=url.split("#")[0];if(match===null){var hasQuestionMark=/\?/.test(url);delimiter=hasQuestionMark?"&":"?";newString=url+delimiter+param+"="+value}else{delimiter=match[0].charAt(0);newString=url.replace(re,delimiter+param+"="+value)}if(hash){newString+="#"+hash}return newString}