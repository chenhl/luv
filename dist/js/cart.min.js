function updateQty(item_id,up_type,qty=null){var data={item_id:item_id,up_type:up_type};if(qty!==null)data.qty=qty;data[csrfName]=csrfVal;$.ajax({url:updateCartInfoUrl,type:"POST",dataType:"json",data:data,success:function(response){if(response.status==="success"){if(up_type==="remove"){$('.cart-item-js[data-item-id="'+item_id+'"]').fadeOut(300,function(){$(this).remove();updateCheckoutButton()})}else{updateCheckoutButton()}}else{alert(response.message||"Update failed")}},error:function(){alert("Network error")}})}function updateCheckoutButton(){const $checkedItems=$(".item-checkbox-js:checked");const checkedCount=$checkedItems.length;let total=0;$checkedItems.each(function(){const price=parseFloat($(this).data("price"))||0;const qty=parseInt($("#qty-js-"+$(this).val()).val())||0;total+=price*qty});$("#total-price-js").text(total.toFixed(2));$("#checkout-count-js").text(checkedCount);$("#btn-checkout-js").prop("disabled",checkedCount===0);const allChecked=$(".item-checkbox-js").length>0&&$checkedItems.length===$(".item-checkbox-js").length;$("#check-all-js").prop("checked",allChecked)}function paypalBuynowCreatePayment(){if(!paypal_client_id)return;$("#paypal-button-container").empty();var fundingSources=[paypal.FUNDING.PAYPAL];fundingSources.forEach(function(fundingSource){var button=paypal.Buttons({fundingSource:fundingSource,style:{height:38,label:"buynow"},onClick:function(){const total=parseFloat($("#total-price-js").text());if(isNaN(total)||total<=0){showToast(translations.itemRequired,"#toast-js");return false}return true},createOrder:function(data,actions){return fetch(paypalCreateOrderUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({[csrfName]:csrfVal})}).then(function(res){return res.json()}).then(function(order){if(order.id==="-1")throw new Error(order.message);return order.id})},onCancel:data=>{},onApprove:function(data,actions){return fetch(paypalCaptureOrderUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign(data,{[csrfName]:csrfVal}))}).then(function(res){return res.json()}).then(function(orderData){if(orderData.order_sn==="-1"){if(orderData.error_issue==="INSTRUMENT_DECLINED"){return actions.restart()}throw new Error(orderData.message)}window.location.href=paypalFinishOrderUrl+"?order_sn="+encodeURIComponent(orderData.order_sn)})},onError:function(err){alert(err.toString())}});if(button.isEligible()){button.render("#paypal-button-container")}})}$(document).ready(function(){$(document).on("change",".item-checkbox-js",function(){var item_id=$(this).val();var checked=$(this).is(":checked")?1:0;var data={item_id:item_id,checked:checked};data[csrfName]=csrfVal;$.ajax({url:selectOneProductUrl,type:"POST",dataType:"json",data:data,success:function(response){if(response.status==="success"){updateCheckoutButton()}}})});$("#check-all-js").on("change",function(){var checked=$(this).is(":checked")?1:0;var data={checked:checked};data[csrfName]=csrfVal;$.ajax({url:selectAllProductUrl,type:"POST",dataType:"json",data:data,success:function(response){if(response.status==="success"){$(".item-checkbox-js").prop("checked",checked);updateCheckoutButton()}}})});$(document).on("click",".item-plus-js",function(){var $input=$("#qty-js-"+$(this).data("item-id"));var qty=parseInt($input.val())||1;if(qty<max_qty){$input.val(qty+1);updateQty($(this).data("item-id"),"add_one")}});$(document).on("click",".item-minus-js",function(){var $input=$("#qty-js-"+$(this).data("item-id"));var qty=parseInt($input.val())||1;if(qty>1){$input.val(qty-1);updateQty($(this).data("item-id"),"less_one")}});$(document).on("change input",'[id^="qty-js-"]',function(){var item_id=$(this).attr("id").replace("qty-js-","");var qty=parseInt($(this).val())||1;qty=Math.max(1,Math.min(max_qty,qty));$(this).val(qty);updateQty(item_id,"set_num",qty)});var pendingDeleteItemId=null;$("#removeDialog").on("show.bs.modal",function(event){var button=$(event.relatedTarget);pendingDeleteItemId=button.data("item-id")});$("#removeDialog .btn-primary").on("click",function(){if(pendingDeleteItemId){updateQty(pendingDeleteItemId,"remove");$("#removeDialog").modal("hide");pendingDeleteItemId=null}});$("#btn-checkout-js").on("click",function(){if($(this).prop("disabled")){return}$(this).prop("disabled",true);const selectedCount=$(".item-checkbox-js:checked").length;if(selectedCount===0){$(this).prop("disabled",false);showToast(translations.itemRequired,"#toast-js");return false}$(this).prop("disabled",true).text(translations.checkoutIng);window.location.href=checkoutUrl});if(paypal_client_id!==""&&has_product){if(typeof paypal==="undefined"){webLoadScript(paypalSdkUrl,function(){paypalBuynowCreatePayment()})}else{paypalBuynowCreatePayment()}}});