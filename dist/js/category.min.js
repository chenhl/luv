function resetUrl(p){var url=category_url;var path="";path+="/p"+p;url+=path;url+=window.location.search;return url}$(document).ready(function(){const lazyLoadInstance=new LazyLoad({});$(document).on("click","#filter-reset-js",function(){window.location.href=category_url});$(document).on("click","#apply-filter-js",function(){var url=new URL(category_url,window.location.origin);var params=new URLSearchParams;var keyword=$("#filter-keyword-js").val().trim();if(keyword)params.set("q",keyword);var begin=$("#filter-price-min-js").val().trim();var end=$("#filter-price-max-js").val().trim();var priceValid=val=>{let n=parseFloat(val);return!isNaN(n)&&n>=0};if(begin&&priceValid(begin)||end&&priceValid(end)){let min=begin&&priceValid(begin)?parseFloat(begin):0;let max=end&&priceValid(end)?parseFloat(end):0;params.set("price",min+"-"+max)}$(".filter-attr-js").each(function(){var attrCode=$(this).data("attr-code");var selectedIds=[];$(this).find(".filter-value-item-js.active").each(function(){selectedIds.push($(this).data("value-id"))});if(selectedIds.length>0){params.set(attrCode,selectedIds.join(","))}});url.search=params.toString();window.location.href=url.toString()});$(document).on("click",".filter-value-item-js",function(){var $item=$(this);var attrCode=$item.closest(".filter-attr-js").data("attr-code");var valueName=$item.text().replace(/\s*âœ“\s*$/,"").trim();var valueId=$item.data("value-id");if($item.hasClass("active")){$item.removeClass("active bg-primary text-white");var idx=selected_attr_values_map[attrCode].indexOf(valueName);if(idx!==-1)selected_attr_values_map[attrCode].splice(idx,1)}else{if(selected_attr_values_map[attrCode].length>=10){alert("You can select up to ten items");return}$item.addClass("active bg-primary text-white");selected_attr_values_map[attrCode].push(valueName)}});$("#product-list-more").infiniteScroll({path:function(){if(this.loadCount<maxPage-1){return resetUrl(this.loadCount+2)}},append:".col-6.col-sm-4.col-md-3.flex-shrink-0",history:"replace",historyTitle:false,responseBody:"text",checkLastPage:true,scrollThreshold:100,status:".page-load-status",prefill:false,debug:false});$("#product-list-more").on("load.infiniteScroll",function(event,body,path){});$("#product-list-more").on("error.infiniteScroll",function(event,error,path){alert("Failed to load more products.")});$("#product-list-more").on("append.infiniteScroll",function(event,body,path,items){if(lazyLoadInstance){lazyLoadInstance.update()}});$("#product-list-more").on("last.infiniteScroll",function(){})});